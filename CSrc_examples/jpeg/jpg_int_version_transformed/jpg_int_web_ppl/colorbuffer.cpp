#include <stdio.h>
#include <stdlib.h>
#include "jpegEncoder.h"
int Y_Red_Table    [256] ={
	0,19595,39191,58787,78383,97978,117574,137170,156766,176361,195957,215553,235149,254744,274340,293936,313532,333127,352723,372319,391915,411511,431106,450702,470298,489894,509489,529085,548681,568277,587872,607468,627064,646660,666255,685851,705447,725043,744639,764234,783830,803426,823022,842617,862213,881809,901405,921000,940596,960192,979788,999383,1018979,1038575,1058171,1077767,1097362,1116958,1136554,1156150,1175745,1195341,1214937,1234533,1254128,1273724,1293320,1312916,1332511,1352107,1371703,1391299,1410895,1430490,1450086,1469682,1489278,1508873,1528469,1548065,1567661,1587256,1606852,1626448,1646044,1665639,1685235,1704831,1724427,1744022,1763618,1783214,1802810,1822406,1842001,1861597,1881193,1900789,1920384,1939980,1959576,1979172,1998767,2018363,2037959,2057555,2077150,2096746,2116342,2135938,2155534,2175129,2194725,2214321,2233917,2253512,2273108,2292704,2312300,2331895,2351491,2371087,2390683,2410278,2429874,2449470,2469066,2488662,2508257,2527853,2547449,2567045,2586640,2606236,2625832,2645428,2665023,2684619,2704215,2723811,2743406,2763002,2782598,2802194,2821790,2841385,2860981,2880577,2900173,2919768,2939364,2958960,2978556,2998151,3017747,3037343,3056939,3076534,3096130,3115726,3135322,3154918,3174513,3194109,3213705,3233301,3252896,3272492,3292088,3311684,3331279,3350875,3370471,3390067,3409662,3429258,3448854,3468450,3488045,3507641,3527237,3546833,3566429,3586024,3605620,3625216,3644812,3664407,3684003,3703599,3723195,3742790,3762386,3781982,3801578,3821173,3840769,3860365,3879961,3899557,3919152,3938748,3958344,3977940,3997535,4017131,4036727,4056323,4075918,4095514,4115110,4134706,4154301,4173897,4193493,4213089,4232685,4252280,4271876,4291472,4311068,4330663,4350259,4369855,4389451,4409046,4428642,4448238,4467834,4487429,4507025,4526621,4546217,4565813,4585408,4605004,4624600,4644196,4663791,4683387,4702983,4722579,4742174,4761770,4781366,4800962,4820557,4840153,4859749,4879345,4898941,4918536,4938132,4957728,4977324,4996919};
int Cb_Red_Table  [256]={
	0,-11058,-22116,-33174,-44232,-55290,-66348,-77406,-88464,-99522,-110580,-121638,-132696,-143754,-154812,-165870,-176928,-187986,-199044,-210102,-221160,-232218,-243276,-254335,-265393,-276451,-287509,-298567,-309625,-320683,-331741,-342799,-353857,-364915,-375973,-387031,-398089,-409147,-420205,-431263,-442321,-453379,-464437,-475495,-486553,-497612,-508670,-519728,-530786,-541844,-552902,-563960,-575018,-586076,-597134,-608192,-619250,-630308,-641366,-652424,-663482,-674540,-685598,-696656,-707714,-718772,-729830,-740888,-751947,-763005,-774063,-785121,-796179,-807237,-818295,-829353,-840411,-851469,-862527,-873585,-884643,-895701,-906759,-917817,-928875,-939933,-950991,-962049,-973107,-984165,-995224,-1006282,-1017340,-1028398,-1039456,-1050514,-1061572,-1072630,-1083688,-1094746,-1105804,-1116862,-1127920,-1138978,-1150036,-1161094,-1172152,-1183210,-1194268,-1205326,-1216384,-1227442,-1238500,-1249559,-1260617,-1271675,-1282733,-1293791,-1304849,-1315907,-1326965,-1338023,-1349081,-1360139,-1371197,-1382255,-1393313,-1404371,-1415429,-1426487,-1437545,-1448603,-1459661,-1470719,-1481777,-1492836,-1503894,-1514952,-1526010,-1537068,-1548126,-1559184,-1570242,-1581300,-1592358,-1603416,-1614474,-1625532,-1636590,-1647648,-1658706,-1669764,-1680822,-1691880,-1702938,-1713996,-1725054,-1736113,-1747171,-1758229,-1769287,-1780345,-1791403,-1802461,-1813519,-1824577,-1835635,-1846693,-1857751,-1868809,-1879867,-1890925,-1901983,-1913041,-1924099,-1935157,-1946215,-1957273,-1968331,-1979389,-1990448,-2001506,-2012564,-2023622,-2034680,-2045738,-2056796,-2067854,-2078912,-2089970,-2101028,-2112086,-2123144,-2134202,-2145260,-2156318,-2167376,-2178434,-2189492,-2200550,-2211608,-2222666,-2233725,-2244783,-2255841,-2266899,-2277957,-2289015,-2300073,-2311131,-2322189,-2333247,-2344305,-2355363,-2366421,-2377479,-2388537,-2399595,-2410653,-2421711,-2432769,-2443827,-2454885,-2465943,-2477001,-2488060,-2499118,-2510176,-2521234,-2532292,-2543350,-2554408,-2565466,-2576524,-2587582,-2598640,-2609698,-2620756,-2631814,-2642872,-2653930,-2664988,-2676046,-2687104,-2698162,-2709220,-2720278,-2731337,-2742395,-2753453,-2764511,-2775569,-2786627,-2797685,-2808743,-2819801
};
int Cr_Red_Table   [256]={
	0,32768,65536,98304,131072,163840,196608,229376,262144,294912,327680,360448,393216,425984,458752,491520,524288,557056,589824,622592,655360,688128,720896,753664,786432,819200,851968,884736,917504,950272,983040,1015808,1048576,1081344,1114112,1146880,1179648,1212416,1245184,1277952,1310720,1343488,1376256,1409024,1441792,1474560,1507328,1540096,1572864,1605632,1638400,1671168,1703936,1736704,1769472,1802240,1835008,1867776,1900544,1933312,1966080,1998848,2031616,2064384,2097152,2129920,2162688,2195456,2228224,2260992,2293760,2326528,2359296,2392064,2424832,2457600,2490368,2523136,2555904,2588672,2621440,2654208,2686976,2719744,2752512,2785280,2818048,2850816,2883584,2916352,2949120,2981888,3014656,3047424,3080192,3112960,3145728,3178496,3211264,3244032,3276800,3309568,3342336,3375104,3407872,3440640,3473408,3506176,3538944,3571712,3604480,3637248,3670016,3702784,3735552,3768320,3801088,3833856,3866624,3899392,3932160,3964928,3997696,4030464,4063232,4096000,4128768,4161536,4194304,4227072,4259840,4292608,4325376,4358144,4390912,4423680,4456448,4489216,4521984,4554752,4587520,4620288,4653056,4685824,4718592,4751360,4784128,4816896,4849664,4882432,4915200,4947968,4980736,5013504,5046272,5079040,5111808,5144576,5177344,5210112,5242880,5275648,5308416,5341184,5373952,5406720,5439488,5472256,5505024,5537792,5570560,5603328,5636096,5668864,5701632,5734400,5767168,5799936,5832704,5865472,5898240,5931008,5963776,5996544,6029312,6062080,6094848,6127616,6160384,6193152,6225920,6258688,6291456,6324224,6356992,6389760,6422528,6455296,6488064,6520832,6553600,6586368,6619136,6651904,6684672,6717440,6750208,6782976,6815744,6848512,6881280,6914048,6946816,6979584,7012352,7045120,7077888,7110656,7143424,7176192,7208960,7241728,7274496,7307264,7340032,7372800,7405568,7438336,7471104,7503872,7536640,7569408,7602176,7634944,7667712,7700480,7733248,7766016,7798784,7831552,7864320,7897088,7929856,7962624,7995392,8028160,8060928,8093696,8126464,8159232,8192000,8224768,8257536,8290304,8323072,8355840
};
int Y_Green_Table   [256]={
	0,38470,76940,115410,153880,192350,230820,269290,307761,346231,384701,423171,461641,500111,538581,577051,615522,653992,692462,730932,769402,807872,846342,884813,923283,961753,1000223,1038693,1077163,1115633,1154103,1192574,1231044,1269514,1307984,1346454,1384924,1423394,1461865,1500335,1538805,1577275,1615745,1654215,1692685,1731155,1769626,1808096,1846566,1885036,1923506,1961976,2000446,2038916,2077387,2115857,2154327,2192797,2231267,2269737,2308207,2346678,2385148,2423618,2462088,2500558,2539028,2577498,2615968,2654439,2692909,2731379,2769849,2808319,2846789,2885259,2923730,2962200,3000670,3039140,3077610,3116080,3154550,3193020,3231491,3269961,3308431,3346901,3385371,3423841,3462311,3500782,3539252,3577722,3616192,3654662,3693132,3731602,3770072,3808543,3847013,3885483,3923953,3962423,4000893,4039363,4077833,4116304,4154774,4193244,4231714,4270184,4308654,4347124,4385595,4424065,4462535,4501005,4539475,4577945,4616415,4654885,4693356,4731826,4770296,4808766,4847236,4885706,4924176,4962647,5001117,5039587,5078057,5116527,5154997,5193467,5231937,5270408,5308878,5347348,5385818,5424288,5462758,5501228,5539699,5578169,5616639,5655109,5693579,5732049,5770519,5808989,5847460,5885930,5924400,5962870,6001340,6039810,6078280,6116750,6155221,6193691,6232161,6270631,6309101,6347571,6386041,6424512,6462982,6501452,6539922,6578392,6616862,6655332,6693802,6732273,6770743,6809213,6847683,6886153,6924623,6963093,7001564,7040034,7078504,7116974,7155444,7193914,7232384,7270854,7309325,7347795,7386265,7424735,7463205,7501675,7540145,7578616,7617086,7655556,7694026,7732496,7770966,7809436,7847906,7886377,7924847,7963317,8001787,8040257,8078727,8117197,8155667,8194138,8232608,8271078,8309548,8348018,8386488,8424958,8463429,8501899,8540369,8578839,8617309,8655779,8694249,8732719,8771190,8809660,8848130,8886600,8925070,8963540,9002010,9040481,9078951,9117421,9155891,9194361,9232831,9271301,9309771,9348242,9386712,9425182,9463652,9502122,9540592,9579062,9617533,9656003,9694473,9732943,9771413,9809883
};
int Cb_Green_Table [256]={
	0,-21708,-43417,-65126,-86835,-108544,-130253,-151962,-173671,-195380,-217089,-238798,-260507,-282216,-303925,-325634,-347343,-369052,-390761,-412470,-434179,-455888,-477597,-499305,-521014,-542723,-564432,-586141,-607850,-629559,-651268,-672977,-694686,-716395,-738104,-759813,-781522,-803231,-824940,-846649,-868358,-890067,-911776,-933485,-955194,-976902,-998611,-1020320,-1042029,-1063738,-1085447,-1107156,-1128865,-1150574,-1172283,-1193992,-1215701,-1237410,-1259119,-1280828,-1302537,-1324246,-1345955,-1367664,-1389373,-1411082,-1432791,-1454500,-1476208,-1497917,-1519626,-1541335,-1563044,-1584753,-1606462,-1628171,-1649880,-1671589,-1693298,-1715007,-1736716,-1758425,-1780134,-1801843,-1823552,-1845261,-1866970,-1888679,-1910388,-1932097,-1953805,-1975514,-1997223,-2018932,-2040641,-2062350,-2084059,-2105768,-2127477,-2149186,-2170895,-2192604,-2214313,-2236022,-2257731,-2279440,-2301149,-2322858,-2344567,-2366276,-2387985,-2409694,-2431403,-2453111,-2474820,-2496529,-2518238,-2539947,-2561656,-2583365,-2605074,-2626783,-2648492,-2670201,-2691910,-2713619,-2735328,-2757037,-2778746,-2800455,-2822164,-2843873,-2865582,-2887291,-2909000,-2930708,-2952417,-2974126,-2995835,-3017544,-3039253,-3060962,-3082671,-3104380,-3126089,-3147798,-3169507,-3191216,-3212925,-3234634,-3256343,-3278052,-3299761,-3321470,-3343179,-3364888,-3386597,-3408305,-3430014,-3451723,-3473432,-3495141,-3516850,-3538559,-3560268,-3581977,-3603686,-3625395,-3647104,-3668813,-3690522,-3712231,-3733940,-3755649,-3777358,-3799067,-3820776,-3842485,-3864194,-3885903,-3907611,-3929320,-3951029,-3972738,-3994447,-4016156,-4037865,-4059574,-4081283,-4102992,-4124701,-4146410,-4168119,-4189828,-4211537,-4233246,-4254955,-4276664,-4298373,-4320082,-4341791,-4363500,-4385208,-4406917,-4428626,-4450335,-4472044,-4493753,-4515462,-4537171,-4558880,-4580589,-4602298,-4624007,-4645716,-4667425,-4689134,-4710843,-4732552,-4754261,-4775970,-4797679,-4819388,-4841097,-4862806,-4884514,-4906223,-4927932,-4949641,-4971350,-4993059,-5014768,-5036477,-5058186,-5079895,-5101604,-5123313,-5145022,-5166731,-5188440,-5210149,-5231858,-5253567,-5275276,-5296985,-5318694,-5340403,-5362111,-5383820,-5405529,-5427238,-5448947,-5470656,-5492365,-5514074,-5535783
};
int Cr_Green_Table  [256]={
	0,-27438,-54877,-82316,-109755,-137193,-164632,-192071,-219510,-246948,-274387,-301826,-329265,-356703,-384142,-411581,-439020,-466459,-493897,-521336,-548775,-576214,-603652,-631091,-658530,-685969,-713407,-740846,-768285,-795724,-823163,-850601,-878040,-905479,-932918,-960356,-987795,-1015234,-1042673,-1070111,-1097550,-1124989,-1152428,-1179867,-1207305,-1234744,-1262183,-1289622,-1317060,-1344499,-1371938,-1399377,-1426815,-1454254,-1481693,-1509132,-1536570,-1564009,-1591448,-1618887,-1646326,-1673764,-1701203,-1728642,-1756081,-1783519,-1810958,-1838397,-1865836,-1893274,-1920713,-1948152,-1975591,-2003030,-2030468,-2057907,-2085346,-2112785,-2140223,-2167662,-2195101,-2222540,-2249978,-2277417,-2304856,-2332295,-2359734,-2387172,-2414611,-2442050,-2469489,-2496927,-2524366,-2551805,-2579244,-2606682,-2634121,-2661560,-2688999,-2716438,-2743876,-2771315,-2798754,-2826193,-2853631,-2881070,-2908509,-2935948,-2963386,-2990825,-3018264,-3045703,-3073141,-3100580,-3128019,-3155458,-3182897,-3210335,-3237774,-3265213,-3292652,-3320090,-3347529,-3374968,-3402407,-3429845,-3457284,-3484723,-3512162,-3539601,-3567039,-3594478,-3621917,-3649356,-3676794,-3704233,-3731672,-3759111,-3786549,-3813988,-3841427,-3868866,-3896305,-3923743,-3951182,-3978621,-4006060,-4033498,-4060937,-4088376,-4115815,-4143253,-4170692,-4198131,-4225570,-4253009,-4280447,-4307886,-4335325,-4362764,-4390202,-4417641,-4445080,-4472519,-4499957,-4527396,-4554835,-4582274,-4609712,-4637151,-4664590,-4692029,-4719468,-4746906,-4774345,-4801784,-4829223,-4856661,-4884100,-4911539,-4938978,-4966416,-4993855,-5021294,-5048733,-5076172,-5103610,-5131049,-5158488,-5185927,-5213365,-5240804,-5268243,-5295682,-5323120,-5350559,-5377998,-5405437,-5432876,-5460314,-5487753,-5515192,-5542631,-5570069,-5597508,-5624947,-5652386,-5679824,-5707263,-5734702,-5762141,-5789580,-5817018,-5844457,-5871896,-5899335,-5926773,-5954212,-5981651,-6009090,-6036528,-6063967,-6091406,-6118845,-6146283,-6173722,-6201161,-6228600,-6256039,-6283477,-6310916,-6338355,-6365794,-6393232,-6420671,-6448110,-6475549,-6502987,-6530426,-6557865,-6585304,-6612743,-6640181,-6667620,-6695059,-6722498,-6749936,-6777375,-6804814,-6832253,-6859691,-6887130,-6914569,-6942008,-6969447,-6996885
};
int Y_Blue_Table   [256]={
	0,7471,14943,22414,29886,37358,44829,52301,59772,67244,74716,82187,89659,97130,104602,112074,119545,127017,134488,141960,149432,156903,164375,171846,179318,186790,194261,201733,209204,216676,224148,231619,239091,246562,254034,261506,268977,276449,283920,291392,298864,306335,313807,321278,328750,336222,343693,351165,358636,366108,373580,381051,388523,395995,403466,410938,418409,425881,433353,440824,448296,455767,463239,470711,478182,485654,493125,500597,508069,515540,523012,530483,537955,545427,552898,560370,567841,575313,582785,590256,597728,605199,612671,620143,627614,635086,642557,650029,657501,664972,672444,679915,687387,694859,702330,709802,717273,724745,732217,739688,747160,754632,762103,769575,777046,784518,791990,799461,806933,814404,821876,829348,836819,844291,851762,859234,866706,874177,881649,889120,896592,904064,911535,919007,926478,933950,941422,948893,956365,963836,971308,978780,986251,993723,1001194,1008666,1016138,1023609,1031081,1038552,1046024,1053496,1060967,1068439,1075910,1083382,1090854,1098325,1105797,1113268,1120740,1128212,1135683,1143155,1150627,1158098,1165570,1173041,1180513,1187985,1195456,1202928,1210399,1217871,1225343,1232814,1240286,1247757,1255229,1262701,1270172,1277644,1285115,1292587,1300059,1307530,1315002,1322473,1329945,1337417,1344888,1352360,1359831,1367303,1374775,1382246,1389718,1397189,1404661,1412133,1419604,1427076,1434547,1442019,1449491,1456962,1464434,1471905,1479377,1486849,1494320,1501792,1509264,1516735,1524207,1531678,1539150,1546622,1554093,1561565,1569036,1576508,1583980,1591451,1598923,1606394,1613866,1621338,1628809,1636281,1643752,1651224,1658696,1666167,1673639,1681110,1688582,1696054,1703525,1710997,1718468,1725940,1733412,1740883,1748355,1755826,1763298,1770770,1778241,1785713,1793184,1800656,1808128,1815599,1823071,1830542,1838014,1845486,1852957,1860429,1867901,1875372,1882844,1890315,1897787,1905259
};
int Cb_Blue_Table [256]={
	0,32768,65536,98304,131072,163840,196608,229376,262144,294912,327680,360448,393216,425984,458752,491520,524288,557056,589824,622592,655360,688128,720896,753664,786432,819200,851968,884736,917504,950272,983040,1015808,1048576,1081344,1114112,1146880,1179648,1212416,1245184,1277952,1310720,1343488,1376256,1409024,1441792,1474560,1507328,1540096,1572864,1605632,1638400,1671168,1703936,1736704,1769472,1802240,1835008,1867776,1900544,1933312,1966080,1998848,2031616,2064384,2097152,2129920,2162688,2195456,2228224,2260992,2293760,2326528,2359296,2392064,2424832,2457600,2490368,2523136,2555904,2588672,2621440,2654208,2686976,2719744,2752512,2785280,2818048,2850816,2883584,2916352,2949120,2981888,3014656,3047424,3080192,3112960,3145728,3178496,3211264,3244032,3276800,3309568,3342336,3375104,3407872,3440640,3473408,3506176,3538944,3571712,3604480,3637248,3670016,3702784,3735552,3768320,3801088,3833856,3866624,3899392,3932160,3964928,3997696,4030464,4063232,4096000,4128768,4161536,4194304,4227072,4259840,4292608,4325376,4358144,4390912,4423680,4456448,4489216,4521984,4554752,4587520,4620288,4653056,4685824,4718592,4751360,4784128,4816896,4849664,4882432,4915200,4947968,4980736,5013504,5046272,5079040,5111808,5144576,5177344,5210112,5242880,5275648,5308416,5341184,5373952,5406720,5439488,5472256,5505024,5537792,5570560,5603328,5636096,5668864,5701632,5734400,5767168,5799936,5832704,5865472,5898240,5931008,5963776,5996544,6029312,6062080,6094848,6127616,6160384,6193152,6225920,6258688,6291456,6324224,6356992,6389760,6422528,6455296,6488064,6520832,6553600,6586368,6619136,6651904,6684672,6717440,6750208,6782976,6815744,6848512,6881280,6914048,6946816,6979584,7012352,7045120,7077888,7110656,7143424,7176192,7208960,7241728,7274496,7307264,7340032,7372800,7405568,7438336,7471104,7503872,7536640,7569408,7602176,7634944,7667712,7700480,7733248,7766016,7798784,7831552,7864320,7897088,7929856,7962624,7995392,8028160,8060928,8093696,8126464,8159232,8192000,8224768,8257536,8290304,8323072,8355840
};
int Cr_Blue_Table  [256]={
	0,-5328,-10656,-15984,-21312,-26641,-31969,-37297,-42625,-47954,-53282,-58610,-63938,-69267,-74595,-79923,-85251,-90579,-95908,-101236,-106564,-111892,-117221,-122549,-127877,-133205,-138534,-143862,-149190,-154518,-159846,-165175,-170503,-175831,-181159,-186488,-191816,-197144,-202472,-207801,-213129,-218457,-223785,-229113,-234442,-239770,-245098,-250426,-255755,-261083,-266411,-271739,-277068,-282396,-287724,-293052,-298381,-303709,-309037,-314365,-319693,-325022,-330350,-335678,-341006,-346335,-351663,-356991,-362319,-367648,-372976,-378304,-383632,-388960,-394289,-399617,-404945,-410273,-415602,-420930,-426258,-431586,-436915,-442243,-447571,-452899,-458227,-463556,-468884,-474212,-479540,-484869,-490197,-495525,-500853,-506182,-511510,-516838,-522166,-527494,-532823,-538151,-543479,-548807,-554136,-559464,-564792,-570120,-575449,-580777,-586105,-591433,-596762,-602090,-607418,-612746,-618074,-623403,-628731,-634059,-639387,-644716,-650044,-655372,-660700,-666029,-671357,-676685,-682013,-687341,-692670,-697998,-703326,-708654,-713983,-719311,-724639,-729967,-735296,-740624,-745952,-751280,-756608,-761937,-767265,-772593,-777921,-783250,-788578,-793906,-799234,-804563,-809891,-815219,-820547,-825875,-831204,-836532,-841860,-847188,-852517,-857845,-863173,-868501,-873830,-879158,-884486,-889814,-895143,-900471,-905799,-911127,-916455,-921784,-927112,-932440,-937768,-943097,-948425,-953753,-959081,-964410,-969738,-975066,-980394,-985722,-991051,-996379,-1001707,-1007035,-1012364,-1017692,-1023020,-1028348,-1033677,-1039005,-1044333,-1049661,-1054989,-1060318,-1065646,-1070974,-1076302,-1081631,-1086959,-1092287,-1097615,-1102944,-1108272,-1113600,-1118928,-1124256,-1129585,-1134913,-1140241,-1145569,-1150898,-1156226,-1161554,-1166882,-1172211,-1177539,-1182867,-1188195,-1193524,-1198852,-1204180,-1209508,-1214836,-1220165,-1225493,-1230821,-1236149,-1241478,-1246806,-1252134,-1257462,-1262791,-1268119,-1273447,-1278775,-1284103,-1289432,-1294760,-1300088,-1305416,-1310745,-1316073,-1321401,-1326729,-1332058,-1337386,-1342714,-1348042,-1353370,-1358699
};
/* The values are computed by this tableCompute function
	 void computeTable()
	 {
	 unsigned short R, G, B;

	 for (R = 0; R < 256; R++)
	 {
	 Y_Red_Table[R] = (int)((65536 * 0.299 + 0.5) * R);
	 Cb_Red_Table[R] = (int)((65536 * -0.16874 + 0.5) * R);
	 Cr_Red_Table[R] = (int)((32768) * R);
	 }
	 for (G = 0; G < 256; G++)
	 {
	 Y_Green_Table[G] = (int)((65536 * 0.587 + 0.5) * G);
	 Cb_Green_Table[G] = (int)((65536 * -0.33126 + 0.5) * G);
	 Cr_Green_Table[G] = (int)((65536 * -0.41869 + 0.5) * G);
	 }
	 for (B = 0; B < 256; B++)
	 {
	 Y_Blue_Table[B] = (int)((65536 * 0.114 + 0.5) * B);
	 Cb_Blue_Table[B] = (int)((32768) * B);
	 Cr_Blue_Table[B] = (int)((65536 * -0.08131 + 0.5) * B);
	 }
	 }*/
#include <stdio.h>
char getY(unsigned char R, unsigned char G, unsigned char B)
{
	return (char)((((Y_Red_Table[R] + Y_Green_Table[G] +  Y_Blue_Table[B]) >> 16) - 128));
}
char getU(unsigned char R, unsigned char G, unsigned char B)
{
	return  (char)((Cb_Red_Table[R] +Cb_Green_Table[G] + Cb_Blue_Table[B]) >> 16);
}
char getV(unsigned char R, unsigned char G, unsigned char B)
{
	return  (char)((Cr_Red_Table[R] +Cr_Green_Table[G] + Cr_Blue_Table[B]) >> 16);
}
void colorBuffer(bool color_mode, int sampling, unsigned int width, 
								const unsigned char buf[MAX_ROWBUF_WIDTH*3*16], 
								yuv_t yQ[64], yuv_t uQ[64], yuv_t vQ[64],
								bool& yen, bool& uen, bool& ven
)
{
	static int i = 0;
	unsigned char ptrY=0;
	static bool sampling_xptr=0;
	static bool sampling_yptr=0;
	unsigned char ptrUV= (sampling_yptr<<2)+(sampling_xptr<<5);
	int xsampling = 0x1 & sampling;
  int ysampling = (0x02 & sampling)>>1;
	yen=1;
	if(color_mode==true)
	{
		for(int l=0; l<8; l++) // col
		{
#pragma HLS pipeline
			for(int k=0; k<8; k++) // row
			{
				yuv_t Y,U,V;

				Y=getY(	buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3 + l*3],
								buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3+l*3+1],
								buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3+l*3+2] );

				U=getU(	buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3 + l*3],
								buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3+l*3+1],
								buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3+l*3+2] );

				V=getV(	buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3 + l*3],
								buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3+l*3+1],
								buf[i*24 +((sampling_yptr<<3)+ k)*MAX_ROWBUF_WIDTH*3+l*3+2] );

				yQ[ptrY]=Y;
				if((ysampling & k)==0 &&(xsampling & l)==0)
				{
					uQ[ptrUV]=U;
					vQ[ptrUV]=V;
		if(ptrUV==63) 
		{
			uen=1;
			ven=1;
		}else
		{
			uen=0;
			ven=0;
		}
					ptrUV=ptrUV+1;
				}
				ptrY++;
			}
			ptrUV=ptrUV + ( (ysampling==1 && ((ysampling & l) == 1)) ? 4:0) ;
		}
		i=(i+1 + -2*(sampling_xptr&ysampling& ~sampling_yptr))%(width/8);
		sampling_yptr=(sampling_yptr + ((ysampling==1 && xsampling==1) ? sampling_xptr : 0))%2;
		sampling_xptr=(sampling_xptr+xsampling)%2;		
	}
	else
	{
		ven=0;
		uen=0;
		for(int l=0; l<8; l++)
		{
#pragma HLS pipeline
			for(int k=0;k<8;k++)
			{
				yQ[ptrY]=(buf[i*8 + k*1920 + l]);
				ptrY++;
			}
		}
		i=(i+1)%(width/(8));
	}
	//printf("yen uen ven %d %d %d\n", yen, uen,ven);
}

